



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Project documentation for NEP">
      
      
        <link rel="canonical" href="https://enriquecoronadozu.github.io/publish/">
      
      
        <meta name="author" content="Enrique Coronado">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.1">
    
    
      
        <title>NEP API</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.3020aac5.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#1-using-fixed-ip-and-port-values" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://enriquecoronadozu.github.io/" title="NEP" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              NEP
            </span>
            <span class="md-header-nav__topic">
              Publish-Subscribe
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://enriquecoronadozu.github.io/learn-nep/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Enriquecoronadozu
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://enriquecoronadozu.github.io/" title="NEP" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    NEP
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://enriquecoronadozu.github.io/learn-nep/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Enriquecoronadozu
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../patterns/" title="Basic theory" class="md-nav__link">
      Basic theory
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Python version
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Python version
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Publish-Subscribe
      </label>
    
    <a href="./" title="Publish-Subscribe" class="md-nav__link md-nav__link--active">
      Publish-Subscribe
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-using-fixed-ip-and-port-values" title="1.- Using fixed IP and port values" class="md-nav__link">
    1.- Using fixed IP and port values
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#communication-between-different-pcs" title="Communication between different PCs" class="md-nav__link">
    Communication between different PCs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-ros-ros2-zmq-and-nanomsg-reusable-architectures" title="2.- ROS, ROS2, ZMQ and nanomsg reusable architectures" class="md-nav__link">
    2.- ROS, ROS2, ZMQ and nanomsg reusable architectures
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../server/" title="Client-Server" class="md-nav__link">
      Client-Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../c_sharp/" title="C# version" class="md-nav__link">
      C# version
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../java/" title="Java (Matlab and Android)" class="md-nav__link">
      Java (Matlab and Android)
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-using-fixed-ip-and-port-values" title="1.- Using fixed IP and port values" class="md-nav__link">
    1.- Using fixed IP and port values
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#communication-between-different-pcs" title="Communication between different PCs" class="md-nav__link">
    Communication between different PCs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-ros-ros2-zmq-and-nanomsg-reusable-architectures" title="2.- ROS, ROS2, ZMQ and nanomsg reusable architectures" class="md-nav__link">
    2.- ROS, ROS2, ZMQ and nanomsg reusable architectures
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Publish-Subscribe</h1>
                
                <p>In a Publish-Subscribe pattern, a producer of messages (publisher) send messages without knowing if any receiver (subscriber) exists. </p>
<p><img alt="Material Screenshot" src="../img/ps.png" /></p>
<p>Two option are ecpresed this tutorial:</p>
<ul>
<li>Option 1: using fixed IP and port values (for very simple architectures)</li>
<li>Option 2: Using a ROS, ROS2.0, ZMQ and nanomsg reusable architectures</li>
</ul>
<p>Options 1 can be enough when the problem to solve requires only to connect two process that run, for example, in diferent machines or in diferent version of Python (2 and 3). However, if it is need to have more lost-lasting, and reusable code, the option 2 is better suited.  </p>
<h2 id="1-using-fixed-ip-and-port-values"><strong>1.- Using fixed IP and port values </strong></h2>
<p>A simple publisher node can be defined as:</p>
<pre><code class="python">import nep
import time

# Create a new node
node = nep.node(&quot;publisher_sample&quot;)

# Select the configuration of the publisher
conf = node.direct(ip = &quot;127.0.0.1&quot;, port =  9090, mode =&quot;one2many&quot;)

# Set the topic and the configuration of the publisher
pub = node.new_pub(&quot;pub_sub_test&quot;,&quot;json&quot;,conf)

# Publish a message each second
while True: 
  msg = {&quot;info&quot;:&quot;hello&quot;}
  pub.publish(msg) 
  time.sleep(1)
</code></pre>

<p>First we need to create a new <code>nep.node</code> instance with is denoted as <code>node</code>. The we define the type of architecture to use in the line:
<code>conf = node.direct(ip = "127.0.0.1", port =  9090, mode ="one2many")</code></p>
<p>This line define the IP address and port of the publisher to create, as well the type of publisher, which can be 
<code>"one2many"</code> or <code>many2one</code>. On the one hand, in the <code>"one2many"</code> mode only one publisher can send messages an undefined number of subscribers. On the other hand, in the <code>"many2one"</code> mode an undefined number of publisher can send information to just one subscriber. </p>
<blockquote>
<p><strong>WARNING 1:</strong> Nodes with diferent mode (one2many or many2one) can not be communicated betweem them. </p>
<p><strong>WARNING 2:</strong> It is not possible to execute more than one  <code>"one2many"</code> publishers that have the same IP and port values.</p>
<p><strong>WARNING 3:</strong> It is not possible to execute more than one  <code>"many2one"</code> susbcribers that have the same IP and port values.</p>
</blockquote>
<p>Then we need to define a new publisher instance using the <code>new_pub</code> function. In this function we need to define a topic name (message identifier), the type of message ("json" or "string") and the configuration of the publisher. In this case the topic is defined with the name of <code>pub_sub_test</code> and the message type is <code>json</code> (which enable to use python dictionaries). We also select the configuration value defined in <code>conf</code> variable. The created publisher is then defined in the <code>pub</code> instance.</p>
<p>Finally a message defined as a python dictionary is sent each second using the <code>publish</code> function of the <code>pub</code> instance.</p>
<p>The subcriber node able to read the messages of the publisher defined before can be defined as:</p>
<pre><code class="python">import nep

# Function executed each time gets a new message
def mycallback(msg): 
    print (msg) # Print message
    # Use here msg for some operation ...

# Create a new node
node = nep.node(&quot;subscriber_sample&quot;)

# Select the configuration of the subscriber
conf = node.direct(ip = &quot;127.0.0.1&quot;, port =  9090, mode =&quot;one2many&quot;)

# Define a new subcriber using a callback function
sub = node.new_callback(&quot;pub_sub_test&quot;, &quot;json&quot; , mycallback, conf)
node.spin()

</code></pre>

<p>In this example we use a function denoted as <code>mycallback</code>, which is executed in a diffenert thread and that be executed each time a new message is read by the subscriber. The configuration set to the subscriber must be the same that the publisher. In this case we use the function <code>new_callback</code> to create the subcriber instance. This function requires the same topic name defined in the subscriber (<code>"pub_sub_test"</code>), the type of message to receive (<code>"json"</code>), the function that will be executed each time a message arrives (<code>mycallback</code>), and the subscriber configuration defined in <code>conf</code>.</p>
<h3 id="communication-between-different-pcs"><strong>Communication between different PCs</strong></h3>
<p>Different computers using different operating systems can be connected using a direct network configuration. This devices need to be connected the same network and specify the IP address of one of the PCs in the network and the same port. The IP value will depend of the publish-subscribe configuration mode.</p>
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg .tg-h8bj{font-weight:bold;background-color:#c0c0c0;color:#333333;border-color:inherit;text-align:center;vertical-align:top}
.tg .tg-us36{border-color:inherit;vertical-align:top}
.tg .tg-00jj{font-style:italic;border-color:inherit;vertical-align:top}
</style>

<table class="tg">
  <tr>
    <th class="tg-h8bj">Mode</th>
    <th class="tg-h8bj">Set the IP value of</th>
  </tr>
  <tr>
    <td class="tg-us36">one2many</td>
    <td class="tg-00jj">Publisher node</td>
  </tr>
  <tr>
    <td class="tg-us36">many2one</td>
    <td class="tg-00jj">Subscriber node</td>
  </tr>
</table>

<p>For example if a one2many publisher node in a PC with IP <code>192.168.11.1</code> need to communicate with a Subscriber node in other PC with IP <code>192.168.11.2</code>, the configuration of the publisher in port <code>10090</code>  must be:</p>
<pre><code class="python">conf = node.direct(ip = &quot;192.168.11.1&quot;, port =  10090, mode =&quot;one2many&quot;)
</code></pre>

<p>and subscriber configuration must be as follow:</p>
<pre><code class="python">conf = node.direct(ip = &quot;192.168.11.1&quot;, port =  10090, mode =&quot;one2many&quot;)
</code></pre>

<h2 id="2-ros-ros2-zmq-and-nanomsg-reusable-architectures"><strong>2.- ROS, ROS2, ZMQ and nanomsg reusable architectures</strong></h2>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../patterns/" title="Basic theory" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Basic theory
              </span>
            </div>
          </a>
        
        
          <a href="../server/" title="Client-Server" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Client-Server
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 Enrique Coronado
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.dc02f8ce.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>