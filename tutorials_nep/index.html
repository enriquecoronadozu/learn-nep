<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Communication patterns - NEP</title>
    <meta name="generator" content="Hugo 0.31.1" />

    
    <meta name="description" content="NEP documentation">
    
    <link rel="canonical" href="https://enriquecoronadozu.github.io/learn-nep/tutorials_nep/">
    
    <meta name="author" content="Enrique Coronado">
    

    <meta property="og:url" content="https://enriquecoronadozu.github.io/learn-nep/tutorials_nep/">
    <meta property="og:title" content="NEP">
    <meta property="og:image" content="https://enriquecoronadozu.github.io/learn-nep/images/logo2.png">
    <meta name="apple-mobile-web-app-title" content="NEP">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://enriquecoronadozu.github.io/learn-nep/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://enriquecoronadozu.github.io/learn-nep/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://enriquecoronadozu.github.io/learn-nep/fonts/icon.eot');
        src: url('https://enriquecoronadozu.github.io/learn-nep/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://enriquecoronadozu.github.io/learn-nep/fonts/icon.woff')
               format('woff'),
             url('https://enriquecoronadozu.github.io/learn-nep/fonts/icon.ttf')
               format('truetype'),
             url('https://enriquecoronadozu.github.io/learn-nep/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://enriquecoronadozu.github.io/learn-nep/stylesheets/application.css">
    <link rel="stylesheet" href="https://enriquecoronadozu.github.io/learn-nep/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://enriquecoronadozu.github.io/learn-nep/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://enriquecoronadozu.github.io/learn-nep/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://enriquecoronadozu.github.io/learn-nep/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-indigo palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Communication patterns
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/enriquecoronadozu/NEP" title="@enriquecoronadozu/NEP on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/enriquecoronadozu/NEP" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://enriquecoronadozu.github.io/learn-nep/images/logo2.png">
        </div>
      
      <div class="name">
        <strong>NEP <span class="version">1.0.0</span></strong>
        
          <br>
          enriquecoronadozu/NEP
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/enriquecoronadozu/NEP/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/enriquecoronadozu/NEP/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Home" href="https://enriquecoronadozu.github.io/learn-nep/">
	
	Home
</a>



  
</li>



<li>
  
    



<a  title="Install NEP/RIZE" href="https://enriquecoronadozu.github.io/learn-nep/install/">
	
	Install NEP/RIZE
</a>



  
</li>



<li>
  
    



<a  title="Basic theory" href="https://enriquecoronadozu.github.io/learn-nep/tutorials/">
	
	Basic theory
</a>



  
</li>



<li>
  
    



<a class="current" title="Communiction patterns" href="https://enriquecoronadozu.github.io/learn-nep/tutorials_nep/">
	
	Communiction patterns
</a>


<ul id="scrollspy">
</ul>


  
</li>



<li>
  
    



<a  title="RIZE" href="https://enriquecoronadozu.github.io/learn-nep/rize/">
	
	RIZE
</a>



  
</li>



<li>
  
    



<a  title="Behavior specification" href="https://enriquecoronadozu.github.io/learn-nep/behavior/">
	
	Behavior specification
</a>



  
</li>



<li>
  
    



<a  title="Compatibility" href="https://enriquecoronadozu.github.io/learn-nep/compatibility/">
	
	Compatibility
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/enriquecoronadozu/NEP" target="_blank" title="@enriquecoronadozu/NEP on GitHub">
              @enriquecoronadozu/NEP on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:enriquecoronadozu@email.com" title="Email of enriquecoronadozu@email.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Communication patterns </h1>

			

<ul>
<li>This tutorial explains how to communicate different nodes using the different patterns supported in NEP</li>
</ul>

<h2 id="client-server">Client-Server</h2>

<p>In the Client-Server pattern a node (Client) sends a request for some data to other node (Server)  and then waits for the response to this request. An example of how to create a simple client-server application is shown bellow:</p>

<h3 id="creates-a-client">Creates a client</h3>

<p>The next Python script shown a simple example of a client node.</p>

<pre><code class="language-python">import nep 
import time 

client = nep.client('127.0.0.1', 8010) # Create a new client instance

while True:
    msg = {&quot;message&quot;:&quot;hello server&quot;} # Message to send as request
    client.send_info(msg)   # Send request
    print client.listen_info() # Wait for server response
    time.sleep(1) # Wait one second
</code></pre>

<p>In this example a new instance of the client class is created with the line:</p>

<p><code>client = nep.client('127.0.0.1', 8010)</code></p>

<p>For this, the IP and PORT parameters are defined as <code>'127.0.0.1'</code> and <code>8010</code> respectivelly.</p>

<p>The function <code>send_info</code>  can be used to send a request to the server. This request must be defined as a python dictionary. In this case the dictionary <code>{&quot;message&quot;:&quot;hello server&quot;}</code> is defined to be send as request.</p>

<p>The function <code>listen_info</code> waits until the server send its response. This function also reads the message sent in that response.</p>

<p>The client class uses ZeroMQ by deafult as transport layer. In order to communicate with a device that uses a normal python TCP/IP sockets, the optional parameter <code>transport</code> can be defined as <code>&quot;normal&quot;</code> in the constructor of a client object. For example:</p>

<pre><code class="language-python">client = nep.client('127.0.0.1', 8010, transport = &quot;normal&quot;) 
</code></pre>

<h3 id="creates-a-server">Creates a server</h3>

<p>The next Python script shown a simple example of a server node.</p>

<pre><code class="language-python">import nep  
import time 

import nep  # Import nep library
server = nep.server('127.0.0.1', 8010) #Create a new server instance

while True:
    msg = msg = {&quot;message&quot;:&quot;hello client&quot;} # Message to send as response
    request = server.listen_info() # Wait for client request
    print request 
    server.send_info(msg) # Send server response
</code></pre>

<p>In this example a new instance of the server class is created with the line:</p>

<p><code>server = nep.server('127.0.0.1', 8010)</code></p>

<p>We need to define the same IP and PORT values that those defined in the client node. The functions <code>listen_info</code> and <code>send_info</code>can be used to read a client request and send a response respectively. In this example the response to be sent in defined as <code>{&quot;message&quot;:&quot;hello client&quot;}</code>.</p>

<p>The function <code>send_info</code>  can be used to send a request to the server. This request must be defined as a python dictionary. In this case the dictionary <code>{&quot;message&quot;:&quot;hello server&quot;}</code> is defined to be send.</p>

<p>The function <code>listen_info</code> waits until the server send its response. This function also reads the message sent in that response.</p>

<p>We can also uses normal python sockets defining the optional parameter <code>transport</code> as <code>&quot;normal&quot;</code>, as shown in the next line:</p>

<pre><code class="language-python">server = nep.server('127.0.0.1', 8010, transport = &quot;normal&quot;) #Create a new client instance
</code></pre>

<div class="admonition note">
<p class="admonition-title">About normal sockets</p>
<p>When using normal sockets the messages to send must be strings, instead of dictionaries.</p>
</div>

<div class="admonition note">
<p class="admonition-title">About ZeroMQ and normal sockets</p>
<p>It is nor possible to communicate a  ZeroMQ socket and a normal socket. Therefore you need to be sure that both client and server has the same trasport layer (ZeroMQ or normal sockets).</p>
</div>

<h2 id="publish-subscribe">Publish-Subscribe</h2>

<p>In a Publish-Subscribe pattern, a producer of messages (publisher) send messages without knowing if any receiver (subscriber) exists. An example of how to create a simple publish-subscriber application is shown bellow:</p>

<h3 id="a-simple-publish-subscribe-example">A simple publish-subscribe example</h3>

<p>The next Python script can be used to create a new publisher instance.</p>

<pre><code class="language-python">import nep
import time

node = nep.node(&quot;publisher_node&quot;) # Create a new node instance
conf = node.conf_pub(transport = &quot;ZMQ&quot;, mode = &quot;many2many&quot;) # Select a ZMQ trasport, P2P network and one2many publisher
pub = node.new_pub(&quot;test&quot;, conf) # Set the topic and the configuration of the publisher 

# Publish a message each second
while True: 
    msg = &quot;hello world&quot;
    pub.send_string(msg) 
    time.sleep(1)
</code></pre>

<p>The next Python script can be used to create a new subscribe instance.</p>

<pre><code class="language-python">import nep

node = nep.node(&quot;subscriber_node&quot;) # Create a new node instance
conf = node.conf_sub(transport =&quot;ZMQ&quot;, mode = &quot;many2many&quot;) # Select a ZMQ trasport, P2P network and one2many subscriber
sub = node.new_sub(&quot;many2one_test&quot;, conf) # Set the topic and the configuration of the subscriber

# Read the information published in the topic registered
while True:
    s, msg = sub.listen_string()
    if s:
        print msg
</code></pre>

<h3 id="create-a-new-node">Create a new node</h3>

<p>In order to perform the communication between of two or more nodes using the Publish-Subscribe pattern, we need to import the nep library and create a new instance of the <code>node</code> class.  The constructor takes one main parameter and an optional parameter. The main parameter defines the name of the node, This name must to be diferent for each node in the network.   In the above examples we define the name of the nodes as <code>publisher_node</code> and <code>subscriber_node</code> for the publisher and subscriber respectivelly. The optional parameter, which default value is <code>False</code>, can be used to specify that a ROS node must to be created when in set with a <code>True</code> value. An example is show bellow:</p>

<pre><code class="language-python">node = nep.node(&quot;publisher_node&quot; , useROS = True)
</code></pre>

<h3 id="define-the-publisher-and-subscriber-configuration">Define the publisher and subscriber configuration</h3>

<p>The NEP library suports direct endpoints conections (only ZeroMQ and nanomsg) and P2P master service conections (in ZeroMQ, nanomsg and ROS). The <code>pub_conf</code> <code>sub_conf</code> methods in the  <code>node</code> class allow to define the configuration of the network to be used in the publisher and subscriber respectively.</p>

<p>In order to define a direct endpoints conection we can use the next line for the publisher:</p>

<pre><code class="language-python">conf = node.conf_sub(network = &quot;direct&quot;, ip = &quot;192.168.0.100&quot;, port = &quot;9090&quot;)
</code></pre>

<p>An the subscriber must be set as below:</p>

<pre><code class="language-python">conf = node.conf_pub(network = &quot;direct&quot;, ip = &quot;192.168.0.100&quot;, port = &quot;9090&quot;)
</code></pre>

<p>The use of a direct network can enable the comunication with other pc, which can have a diferent operating systems via wifi or ethernet network. In a direct network the endpoint to connect (ip and port) must be specified. In the lines above, an ip of <code>&quot;192.168.0.100&quot;</code> and a port of value <code>9090</code> are set.</p>

<p>Most robotics architectures use a master name service in a P2P network. Due that, a <code>&quot;P2P&quot;</code> network configuration is set as default. In ZeroMQ 3 publish-subscribe modes can be set. These types can <strong>one2many</strong>, <strong>many2one</strong> and <strong>many2many</strong>. The next line shows an example of how a <strong>many2many</strong> publisher can be defined:</p>

<p>conf = node.conf_pub(transport = &ldquo;ZMQ&rdquo;, mode = &ldquo;many2many&rdquo;) # Select the configuration of the publisher</p>

<p>The next line shows an example of how a <strong>many2many</strong> subscriber can be defined:</p>

<p>conf = node.conf_sub(transport =&ldquo;ZMQ&rdquo;, mode = &ldquo;many2many&rdquo;) # Select the configuration of the subscriber</p>

<p>We can use the transport parameter to use <strong>nanomsg</strong>  or <strong>ROS</strong> instead <strong>ZeroMQ</strong>. The next line shows how a <strong>nanomsg</strong> publisher is defined.</p>

<pre><code class="language-python">conf = node.conf_pub(transport = &quot;NN&quot;)
</code></pre>

<h3 id="create-instances-for-publishers-and-subcribers">Create instances for publishers and subcribers</h3>

<p>After defining the configuration of the network we can use the <code>new_pub()</code> and <code>new_sub()</code> methods  to create a new  publisher and subscriber instances respectivelly. This functions takes two main parameters. The first parameter is the topic in which information will be sent. The second parameter is used to set the configuration of the publisher/subscriber instance. An example of definition of a new publisher is show in the next line:</p>

<pre><code class="language-python">conf = node.conf_pub(transport = &quot;ZMQ&quot;, mode = &quot;many2many&quot;)
pub = node.new_pub(&quot;test&quot;, conf)
</code></pre>

<p>This publisher will be publish data in the <code>&quot;test&quot;</code> topic, using ZeroMQ in a <em>many2many</em> and <em>P2P</em> network. A subscriber able to read the data send by this publisher can be defined as:</p>

<pre><code class="language-python">conf = node.conf_sub(transport =&quot;ZMQ&quot;, mode = &quot;many2many&quot;)
sub = node.new_pub(&quot;test&quot;, conf)
</code></pre>

<h3 id="start-sending-information">Start sending information</h3>

<p>In order to send information to the network we can use the methods <code>send_string()</code> or <code>send_info()</code>.</p>

<p>When using the <code>send_string()</code> method we can send the information as strings. An example is show bellow:</p>

<pre><code class="language-python">msg = &quot;hello world&quot;
pub.send_string(msg) 
</code></pre>

<p>The function `<code>send_info()</code> can be used to send complex messages in JSON format (python dictionaries) using ZeroMQ and nanomsg or ROS geometric messages such as Point, Pose, Quaternion, etc. An example of sending a ZeroMQ message is shown bellow:</p>

<pre><code class="language-python">msg = {&quot;message&quot;:&quot;hello world&quot;}
pub.send_string(msg) 
</code></pre>

<h3 id="start-listening-information">Start listening information</h3>

<p>In order to get the information that a publisher instance send to the newtwork we can use the<code>listen_string()</code> and <code>listen_info()</code> functions. On the one hand, the <code>listen_string()</code> function in a subscriber instance is used to read data sent by a publisher with the <code>send_string()</code> function. The information send and read by these function must be strings. On the other hand, the <code>listen_info()</code> function in a subscriber instance is used to read data sent by a publisher with the <code>send_info()</code> function. In this case the information send and read must be dictionaries.</p>

<h2 id="using-ros-publishers">Using ROS publishers</h2>


			<aside class="copyright" role="note">
				
				&copy; 2018 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://enriquecoronadozu.github.io/learn-nep/behavior/" title="Behavior specification">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Behavior specification
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://enriquecoronadozu.github.io/learn-nep/compatibility/" title="Programming languages">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Programming languages
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/enriquecoronadozu.github.io\/learn-nep\/';
      var repo_id  = 'enriquecoronadozu\/NEP';
    
    </script>

    <script src="https://enriquecoronadozu.github.io/learn-nep/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

